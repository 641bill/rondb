# Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.
#
<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" 
           Name="MySQL Enterprise Backup @MEB_VERSION_MAJOR@.@MEB_VERSION_MINOR@.@MEB_VERSION_MICRO@" 
           Language="1033" 
           Version="@MEB_VERSION_MAJOR@.@MEB_VERSION_MINOR@.@MEB_VERSION_MICRO@"
           Manufacturer="Oracle Corporation" 
           UpgradeCode="@MEB_MINORMAJOR_UPGRADE_CODE@">

    <Package InstallerVersion="200" Compressed="yes" Platform="@PLATFORM_WIX@" />

    <!-- Upgrade Information -->
    <Upgrade Id="@MEB_MINORMAJOR_UPGRADE_CODE@">
	<UpgradeVersion OnlyDetect="yes" Minimum="@MEB_VERSION_MAJOR@.@MEB_VERSION_MINOR@.@MEB_VERSION_MICRO@"
                        Property="NEWERVERSIONDETECTED" IncludeMinimum="no" />
	<UpgradeVersion OnlyDetect="no" Maximum="@MEB_VERSION_MAJOR@.@MEB_VERSION_MINOR@.@MEB_VERSION_MICRO@"
                        Property="OLDERVERSIONBEINGUPGRADED" IncludeMaximum="no" />
    </Upgrade>

    <!-- Error if a newer version is already installed. -->
    <Condition Message="A later version of MySQL enterprise Backup is already installed. Setup will now exit.">
      NOT NEWERVERSIONDETECTED OR Installed
    </Condition>

    <Media Id="1" Cabinet="media1.cab" EmbedCab="yes" />

    <!-- Graphics -->
    <WixVariable Id="WixUIBannerBmp" Value="meb_header.jpg" />
    <WixVariable Id="WixUIDialogBmp" Value="meb_background.jpg" />
    <Icon Id="icon.ico" SourceFile="meb.ico"/>
    
    <!-- Use a custom WixUI_InstallDir with fixes for 508 compliance -->
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />
    <UIRef Id="MEB_InstallDirUI" />

    <!-- Enable PATH modification if requested -->
    <Property Id="ADDTOPATH" Value="1" />
    <InstallExecuteSequence>
      <WriteEnvironmentStrings>ADDTOPATH=1</WriteEnvironmentStrings>
      <RemoveExistingProducts After="InstallInitialize" />
    </InstallExecuteSequence>

    <Directory Id="TARGETDIR" Name="SourceDir">
      <!-- Files to install -->
      <Directory Id="@MEB_DEFAULT_DEST@">
        <Directory Id="MySQLFolder" Name="MySQL">
          <Directory Id="INSTALLDIR" Name="MySQL Enterprise Backup @MEB_VERSION_MAJOR@.@MEB_VERSION_MINOR@" FileSource=".">
            <Component Id="mysqlbackup" Guid="*">
              <File Id="mysqlbackup.exe" Name="mysqlbackup.exe" Source="$(var.BinaryDir)/mysqlbackup.exe" />
              <Environment Id="PATH_mysqlbackup" Name="PATH" Value="[INSTALLDIR]" Permanent="no" Part="last" Action="set" System="yes" />
            </Component>
            <Component Id="readme" Guid="*">
              <File Id="readme" Name="README.txt" Source="$(var.DocDir)/README.txt"/>
            </Component>
            <Component Id="license" Guid="*">
              <File Id="license" Name="LICENSE.meb.txt" Source="$(var.DocDir)/LICENSE.meb"/>
            </Component>
            <Component Id="license_third_party" Guid="*">
              <File Id="license_third_party" Name="LICENSE.third_party.txt" Source="$(var.DocDir)/LICENSE.third_party"/>
            </Component>
            <Component Id="manual" Guid="*">
              <File Id="manual" Name="manual.html" Source="$(var.DocDir)/manual.html"/>
            </Component>
            <Component Id="mysqlhtml" Guid="*">
              <File Id="mysqlhtml" Name="mvl.css" Source="$(var.DocDir)/mvl.css" />
            </Component>
          </Directory>
        </Directory>
      </Directory>
      <!-- Program menu shortcuts -->
      <Directory Id="ProgramMenuFolder" Name="Programs">
        <Directory Id="ProgramMenuDir" Name="MySQL">
          <Directory Id="ProductMenuDir" Name="MySQL Enterprise Backup @MEB_VERSION_MAJOR@.@MEB_VERSION_MINOR@">
            <Component Id="ProductMenuDir" Guid="*">
              <RemoveFolder Id='ProductMenuDir' Directory='ProductMenuDir' On='uninstall' />
              <RemoveFolder Id='ProgramMenuDir' Directory='ProgramMenuDir' On='uninstall' />
              <RegistryValue Root='HKCU' Key='Software\[Manufacturer]\[ProductName]' Type='string' Value='' KeyPath='yes' />
              <Shortcut Id='shortcut_cli'
                        Icon='icon.ico'
                        Directory='ProductMenuDir' 
                        Name='MySQL Enterprise Backup Command Prompt' 
                        WorkingDirectory='INSTALLDIR'
                        Target='[%ComSpec]'
                        Arguments='/k "[!mysqlbackup.exe]" --version'
                        Show='normal'
                        />
              <Shortcut Id='shortcut_docs'
                        Directory='ProductMenuDir'
                        Name='MySQL Enterprise Backup Documentation'
                        WorkingDirectory='INSTALLDIR'
                        Target='[!manual]'
                        />
              </Component>
          </Directory>
        </Directory>
      </Directory>
    </Directory>

    <Feature Id="MEB" Title="MySQL Enterprise Backup" Level="1">
      <ComponentRef Id="mysqlbackup"/>
      <ComponentRef Id="readme"/>
      <ComponentRef Id="license"/>
      <ComponentRef Id="license_third_party"/>
      <ComponentRef Id="manual"/>
      <ComponentRef Id="mysqlhtml"/>
      <ComponentRef Id="ProductMenuDir"/>
    </Feature>
  </Product>
</Wix>
