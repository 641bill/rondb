# Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.
#
# -*- rpm-spec -*-
Summary:        @CPACK_RPM_PACKAGE_SUMMARY@
Name:           @CPACK_RPM_PACKAGE_NAME@
Version:        @CPACK_RPM_PACKAGE_VERSION@
Release:        @CPACK_RPM_PACKAGE_RELEASE@
License:        @CPACK_RPM_PACKAGE_LICENSE@
Vendor:         @CPACK_PACKAGE_VENDOR@
Packager:       @CPACK_PACKAGE_CONTACT@
Group:          Applications/Databases
Provides:       meb
Prefix:         /opt/mysql
BuildRoot:      @CPACK_RPM_DIRECTORY@/@CPACK_PACKAGE_FILE_NAME@@CPACK_RPM_PACKAGE_COMPONENT_PART_PATH@

%define _rpmdir @CPACK_RPM_DIRECTORY@
%define _rpmfilename @CPACK_RPM_FILE_NAME@
%define _unpackaged_files_terminate_build 0
%define _topdir @CPACK_RPM_DIRECTORY@
@CPACK_RPM_SPEC_MORE_DEFINE@
@CPACK_RPM_COMPRESSION_TYPE_TMP@

%description
Implementing proper database backup and disaster recovery plans to
protect against accidental loss of data, database corruption,
hardware/operating system crashes orany natural disasters has become
one of the most important responsibilities of the Database
Administrator (DBAs).

MySQL Enterprise Backup provides DBAs with a high-performance, online
"hot" backup solution with data compression technology to ensure your
data is protected in case of downtime or an outage. MySQL is a
trademark of @CPACK_PACKAGE_VENDOR@

# This is a shortcutted spec file generated by CMake RPM generator
# we skip _install step because CPack does that for us.
# We do only save CPack installed tree in _prepr
# and then restore it in build.
%prep
mv $RPM_BUILD_ROOT "@CPACK_TOPLEVEL_DIRECTORY@/tmpBBroot"

#p build

%install
if [ -e $RPM_BUILD_ROOT ];
then
  rm -rf $RPM_BUILD_ROOT
fi
# Special fix to have different CMAKE_INSTALL_PREFIX without lots of
# trouble with CPACK_PACKAGING_INSTALL_PREFIX that is a global setting
# for all generators, or CPACK_SET_DESTDIR that requires the user to
# specify CMAKE_INSTALL_PREFIX exactly as this spec wants it
mkdir -p $RPM_BUILD_ROOT/opt/mysql
mv "@CPACK_TOPLEVEL_DIRECTORY@/tmpBBroot/usr" $RPM_BUILD_ROOT/opt/mysql/meb-@CPACK_MEB_PACKAGE_BASE_VERSION@/

%clean

%files
%defattr(-,root,root,-)
%%dir "/opt/"
%%dir "/opt/mysql/"
%%dir "/opt/mysql/meb-@CPACK_MEB_PACKAGE_BASE_VERSION@/"
"/opt/mysql/meb-@CPACK_MEB_PACKAGE_BASE_VERSION@/bin/mysqlbackup"
%%doc "/opt/mysql/meb-@CPACK_MEB_PACKAGE_BASE_VERSION@/README.txt"
%%doc "/opt/mysql/meb-@CPACK_MEB_PACKAGE_BASE_VERSION@/manual.html"
%%doc "/opt/mysql/meb-@CPACK_MEB_PACKAGE_BASE_VERSION@/mvl.css"
%%doc "/opt/mysql/meb-@CPACK_MEB_PACKAGE_BASE_VERSION@/LICENSE.meb"
%%doc "/opt/mysql/meb-@CPACK_MEB_PACKAGE_BASE_VERSION@/LICENSE.third_party"

%changelog
* Wed Sep 13 2017 Ingo Struewing <ingo.struewing@oracle.com>
- Rename LICENSE.mysql to LICENSE.meb on request from Bjorn Munch

* Fri Oct 16 2015 Kent Boortz <kent.boortz@oracle.com>
- Add LICENSE.third_party.

* Tue Jun 16 2015 Kent Boortz <kent.boortz@oracle.com>
- Changes to be used from CMake CPACK_RPM_USER_BINARY_SPECFILE

* Fri Feb 28 2014 Kent Boortz <kent.boortz@oracle.com>
- Changed name of CSS file.

* Fri Aug 23 2013 Kent Boortz <kent.boortz@oracle.com>
- Add LICENSE.mysql.

* Tue Apr 30 2013 Bjorn Munch <bjorn.munch@oracle.com>
- Remove ibbackup and innobackup, they are obsoleted.

* Mon Dec 19 2011 Jonathan Perkin <jonathan.perkin@oracle.com>
- Add mysql-html.css.

* Tue Sep 27 2011 Jonathan Perkin <jonathan.perkin@oracle.com>
- Avoid using _buildrootdir as RHEL/OL6 RPM defines it.

* Tue Sep 20 2011 Jonathan Perkin <jonathan.perkin@oracle.com>
- Fix prefix.  Update email address.

* Wed Jul 20 2011 Daniel Fischer <daniel.fischer@oracle.com>
- Update for MEB 3.6

* Tue Dec 7 2010 Daniel Fischer <daniel.fischer@oracle.com>
- Updated structure and added documentation.

* Wed May 5 2010 Daniel Fischer <df@sun.com>
- Created the MySQL Enterprise Backup spec file.
