###############################################################################
# Test errors while granting and revoking privilege with respect to prior     #
# existence of the privilege.                                                 #
#                                                                             #
# Bug #33897859 Unexpected behaviour seen with revoking a privilege from role.#
###############################################################################

# Prepare
CREATE ROLE rngp_role;
CREATE DATABASE rngp_db;

# Revoke non existent, no privileges -issue error
--error 1141
REVOKE DELETE ON rngp_db.* FROM rngp_role;

# Grant new privileges -OK
GRANT SELECT, CREATE ON rngp_db.* TO rngp_role;
SHOW GRANTS FOR rngp_role;

# Grant already existing privilege -OK, but no change
GRANT SELECT ON rngp_db.* TO rngp_role;
SHOW GRANTS FOR rngp_role;

# Grant already existing privilege altogether with new one -OK
GRANT SELECT, UPDATE ON rngp_db.* TO rngp_role;
SHOW GRANTS FOR rngp_role;

# Revoke existent, -OK
REVOKE UPDATE ON rngp_db.* FROM rngp_role;

# Revoke both existent and not existent privileges at one time
--error 1141
REVOKE SELECT, INSERT ON rngp_db.* FROM rngp_role;

# Revoke non existent, other privileges exist -issue error
--error 1141
REVOKE DELETE ON rngp_db.* FROM rngp_role;

# Check, that UPDATE was removed, but not SELECT
SHOW GRANTS FOR rngp_role;

# Revoke existent -OK
REVOKE CREATE ON rngp_db.* FROM rngp_role;
SHOW GRANTS FOR rngp_role;

# Revoke existent with IF EXISTS clause -OK
REVOKE IF EXISTS SELECT ON rngp_db.* FROM rngp_role;
SHOW GRANTS FOR rngp_role;

# Revoke non existent and existent with IF EXISTS clause
# -issue warning, but do remove the other privilege
REVOKE IF EXISTS CREATE, SELECT ON rngp_db.* FROM rngp_role;
SHOW GRANTS FOR rngp_role;

# Cleanup
DROP ROLE rngp_role;
DROP DATABASE rngp_db;