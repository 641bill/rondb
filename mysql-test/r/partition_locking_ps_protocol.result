#
# Test CREATE SELECT
#
CREATE TABLE t1 (a int PRIMARY KEY, b varchar(128), KEY(b))
ENGINE = InnoDB
PARTITION BY HASH(a) PARTITIONS 13;
INSERT INTO t1 VALUES (1, 'First row, p1');
INSERT INTO t1 VALUES (0, 'First row, p0'), (2, 'First row, p2'),
(3, 'First row, p3'), (4, 'First row, p4');
INSERT INTO t1 VALUES (1 * 13, 'Second row, p0'), (2 * 13, 'Third row, p0'),
(3 * 13, 'Fourth row, p0'), (4 * 13, 'Fifth row, p0');
FLUSH STATUS;
CREATE TABLE t2 SELECT a, b FROM t1 WHERE a in (0, 1, 13, 113);
SELECT * FROM INFORMATION_SCHEMA.SESSION_STATUS
WHERE VARIABLE_NAME LIKE 'HANDLER_%' AND VARIABLE_VALUE >0;
VARIABLE_NAME	VARIABLE_VALUE
HANDLER_COMMIT	8
HANDLER_EXTERNAL_LOCK	112
HANDLER_READ_FIRST	3
HANDLER_READ_KEY	11
HANDLER_READ_NEXT	8
HANDLER_WRITE	23
SELECT * FROM t2 ORDER by a;
a	b
0	First row, p0
1	First row, p1
13	Second row, p0
DROP TABLE t2;
FLUSH STATUS;
CREATE TABLE t2 SELECT a, b FROM t1 WHERE b LIKE 'First%';
SELECT * FROM INFORMATION_SCHEMA.SESSION_STATUS
WHERE VARIABLE_NAME LIKE 'HANDLER_%' AND VARIABLE_VALUE >0;
VARIABLE_NAME	VARIABLE_VALUE
HANDLER_COMMIT	8
HANDLER_EXTERNAL_LOCK	112
HANDLER_READ_KEY	21
HANDLER_READ_NEXT	7
HANDLER_WRITE	25
SELECT * FROM t2 ORDER BY a;
a	b
0	First row, p0
1	First row, p1
2	First row, p2
3	First row, p3
4	First row, p4
DROP TABLE t2, t1;
FLUSH STATUS;
CREATE TABLE t1 (a INT) PARTITION BY HASH (a) PARTITIONS 3;
INSERT INTO t1 VALUES (1), (3), (9), (2), (8), (7);
FLUSH STATUS;
CREATE TABLE t2 SELECT * FROM t1 PARTITION (p1, p2);
SELECT * FROM INFORMATION_SCHEMA.SESSION_STATUS
WHERE VARIABLE_NAME LIKE 'HANDLER_%' AND VARIABLE_VALUE >0;
VARIABLE_NAME	VARIABLE_VALUE
HANDLER_COMMIT	8
HANDLER_EXTERNAL_LOCK	112
HANDLER_READ_FIRST	2
HANDLER_READ_KEY	10
HANDLER_READ_NEXT	1
HANDLER_READ_RND_NEXT	4
HANDLER_WRITE	23
SELECT * FROM t2;
a
1
2
7
8
DROP TABLE t2;
FLUSH STATUS;
CREATE TABLE t2 SELECT * FROM t1 WHERE a IN (1, 3, 9);
SELECT * FROM INFORMATION_SCHEMA.SESSION_STATUS
WHERE VARIABLE_NAME LIKE 'HANDLER_%' AND VARIABLE_VALUE >0;
VARIABLE_NAME	VARIABLE_VALUE
HANDLER_COMMIT	8
HANDLER_EXTERNAL_LOCK	112
HANDLER_READ_FIRST	2
HANDLER_READ_KEY	10
HANDLER_READ_NEXT	1
HANDLER_READ_RND_NEXT	4
HANDLER_WRITE	22
SELECT * FROM t2;
a
1
3
9
DROP TABLE t1, t2;
