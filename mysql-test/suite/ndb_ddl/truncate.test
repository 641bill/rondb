--source setup.inc

#
# Truncate tables one by one and check it's empty
#

let $counter = 1;
while ($counter <= $num_tables)
{
   # Default table name is t$counter, ie. t1, t2, etc
   let $tx=t$counter;

  # Save table id
  let $table_id = `SELECT id FROM test.ndbinfo_dict_obj_info
                     WHERE fq_name = 'ndb_ddl_test/def/$tx'`;

  eval TRUNCATE TABLE $tx;

  # Show that table id is still the same after truncate. When creating
  # table with same name, NDB reuses table id
  let $new_table_id = `SELECT id FROM test.ndbinfo_dict_obj_info
                         WHERE fq_name = 'ndb_ddl_test/def/$tx'`;
  if ($table_id != $new_table_id)
  {
    die The table truncated but didnt get same table id;
  }

  # Check that new table contains expected number of rows
  let $tx_count = `SELECT count(*) from $tx`;
  if ($tx_count != 0)
  {
    echo Wrong number of rows, expected 0 got $tx_count;
    die Wrong number of rows in truncated table;
  }

  inc $counter;
}

--source verify_mysql_dd.inc

--source cleanup.inc

