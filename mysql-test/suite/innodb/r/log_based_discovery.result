use mysql;
MYSQL_TMP_DIR/bootstrap.log
# Stop server MTR default DB server
# Run the bootstrap command of datadir1
# Start the DB server with datadir1
CREATE DATABASE test;
USE test;
CREATE TABLE tab1(c1 INT, c2 VARCHAR(30));
INSERT INTO tab1 VALUES(1, 'Test consistency undo*');
SELECT * FROM tab1;
c1	c2
1	Test consistency undo*
USE mysql;
# Abruptly stop the DB server with datadir1
# Kill the server
# Run the bootstrap command of datadir2
# Start the DB server with datadir2
CREATE DATABASE test;
USE test;
CREATE TABLE tab2(c1 INT, c2 VARCHAR(30));
INSERT INTO tab2 VALUES(1, 'Test consistency undo*');
SELECT * FROM tab2;
c1	c2
1	Test consistency undo*
USE mysql;
# Stop the DB server with datadir2
# Start the DB1 server with wrong path of undo tablespaces, expect an recovery errors
# Start the DB1 server with wrong path of ibdata* tablespaces, expect an recovery errors
# Start the DB server with right path, expect no recovery errors
USE test;
SELECT @@innodb_undo_tablespaces;
@@innodb_undo_tablespaces
5
SELECT @@innodb_data_home_dir;
@@innodb_data_home_dir
MYSQL_TMP_DIR/innodb_data_home_dir1
SELECT @@innodb_undo_directory;
@@innodb_undo_directory
MYSQL_TMP_DIR/innodb_undo_data_dir1
SELECT * FROM tab1;
c1	c2
1	Test consistency undo*
DROP TABLE tab1;
USE mysql;
# Stop the DB server with datadir1
# Start the DB server with datadir2 for cleanup
USE test;
SELECT * FROM tab2;
c1	c2
1	Test consistency undo*
DROP TABLE tab2;
CREATE DATABASE mtr;
USE mtr;
CREATE PROCEDURE mtr.check_warnings(OUT result INT)
BEGIN
SELECT 0 INTO RESULT;
END|
