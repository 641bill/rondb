--source include/have_innodb_16k.inc
--source include/have_64bit.inc
--source include/count_sessions.inc

let SEARCH_FILE = $MYSQLTEST_VARDIR/log/my_restart.err;

--echo # Test starting MySQL with --innodb-log-file-size provided and --innodb-redo-log-capacity provided...
let $restart_parameters = restart: --innodb-log-file-size=16777216 --log-error=$SEARCH_FILE;
--replace_result $SEARCH_FILE ERROR_LOG
--source include/restart_mysqld.inc
let SEARCH_PATTERN = Ignored deprecated configuration parameter innodb_log_file_size\. Used innodb_redo_log_capacity instead\.;
--source include/search_pattern.inc
--source include/shutdown_mysqld.inc
--remove_file $SEARCH_FILE

--echo # Test starting MySQL with --innodb-log-files-in-group provided and --innodb-redo-log-capacity provided...
let $restart_parameters = restart: --innodb-log-files-in-group=8 --log-error=$SEARCH_FILE;
--replace_result $SEARCH_FILE ERROR_LOG
--source include/start_mysqld.inc
let SEARCH_PATTERN = Ignored deprecated configuration parameter innodb_log_files_in_group\. Used innodb_redo_log_capacity instead\.;
--source include/search_pattern.inc
--source include/shutdown_mysqld.inc
--remove_file $SEARCH_FILE

# Remaining fragment of the test is shaky... for now commented out.
#
#let MYSQLD_DATADIR = $MYSQLTEST_VARDIR/tmp/log_deprecated_params;
#let SEARCH_FILE = $MYSQLD_DATADIR/my_restart_attempt.err;
#let MYSQLD_ARGS = --datadir=$MYSQLD_DATADIR --skip-log-bin --log-error-verbosity=3 --lower_case_table_names=1 --innodb-unknown-param=v --skip-networking --socket=$MYSQLD_DATADIR/mytest.sock --log-error=$SEARCH_FILE;
#
#--echo # Test starting MySQL with --innodb-log-file-size provided but without --innodb-redo-log-capacity provided...
#--force-rmdir $MYSQLD_DATADIR
#--mkdir $MYSQLD_DATADIR
#
#--error 1,42 # MySQL is not going to start because data directory is empty (not initialized)
#--exec $MYSQLD $MYSQLD_ARGS --innodb-log-file-size=8388608 ;
#let SEARCH_PATTERN = Deprecated configuration parameters innodb_log_file_size and/or innodb_log_files_in_group have been used to compute innodb_redo_log_capacity=16777216. Please use innodb_redo_log_capacity instead.;
#--source include/search_pattern.inc
#--remove_file $SEARCH_FILE
#--force-rmdir $MYSQLD_DATADIR
#
#--echo # Test starting MySQL with --innodb-log-files-in-group provided but without --innodb-redo-log-capacity provided...
#--mkdir $MYSQLD_DATADIR
#--error 1,42 # MySQL is not going to start because data directory is empty (not initialized)
#--exec $MYSQLD $MYSQLD_ARGS --innodb-log-files-in-group=3 ;
#let SEARCH_PATTERN = Deprecated configuration parameters innodb_log_file_size and/or innodb_log_files_in_group have been used to compute innodb_redo_log_capacity=150994944. Please use innodb_redo_log_capacity instead.;
#--source include/search_pattern.inc
#--remove_file $SEARCH_FILE
#--force-rmdir $MYSQLD_DATADIR

let $restart_parameters = restart:;
--source include/start_mysqld.inc
--source include/wait_until_count_sessions.inc
