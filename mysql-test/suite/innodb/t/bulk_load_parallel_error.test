--source include/have_debug.inc

SHOW VARIABLES LIKE '%fill_factor%';
SET GLOBAL innodb_fill_factor = 10;
CREATE TABLE t1 (f1 INT PRIMARY KEY, f2 BLOB);

--disable_query_log
let $i = 2000;
while ($i) {
  SELECT CHAR(65 + MOD(FLOOR(RAND() * 27), 26)) INTO @random_char;
  SET @min_val = 1;
  SET @max_val = 5000;
  SET @range = @max_val - @min_val;
  SELECT FLOOR(@min_val + RAND() * @range) INTO @random_len;
  eval SET @key = $i;
  INSERT INTO t1 VALUES (@key, REPEAT(@random_char, @random_len));
  dec $i;
}
SET GLOBAL DEBUG = "+d,btree_build_mt_force_error";
--enable_query_log

SET innodb_interpreter = 'bulk_load_split_mode_1';
SHOW VARIABLES LIKE '%fill_factor%';
--error ER_GET_ERRNO
ALTER TABLE t1 ADD INDEX k1(f2(111));

SET innodb_interpreter = 'bulk_load_split_mode_2';
SHOW VARIABLES LIKE '%fill_factor%';
--error ER_GET_ERRNO
ALTER TABLE t1 ADD INDEX k2(f2(150));

DROP TABLE t1;
SET GLOBAL innodb_fill_factor = DEFAULT;
SET GLOBAL DEBUG = "-d,btree_build_mt_force_error";
