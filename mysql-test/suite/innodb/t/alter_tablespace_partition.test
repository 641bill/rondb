--source include/have_innodb.inc

# needed in sourced show_i_s_tablespaces.inc
let $MYSQLD_DATADIR = `select @@datadir`;
let $INNODB_PAGE_SIZE = `select @@innodb_page_size`;

CREATE TABLESPACE s1 ADD DATAFILE 's1.ibd' ENGINE InnoDB;

# Change tablespace of partitioned table from innodb_file_per_table
# to general tablespace
CREATE TABLE t1 (col1 INT, col2 INT) ENGINE = InnoDB TABLESPACE innodb_file_per_table PARTITION BY KEY(col1) PARTITIONS 3;

SHOW CREATE TABLE t1;

--source suite/innodb/include/show_i_s_tables.inc
--source suite/innodb/include/show_i_s_tablespaces.inc

ALTER TABLE t1 ENGINE = InnoDB TABLESPACE s1;

SHOW CREATE TABLE t1;

--source suite/innodb/include/show_i_s_tables.inc
--source suite/innodb/include/show_i_s_tablespaces.inc

DROP TABLE t1;

# Change tablespace of partitioned table from innodb_system
# to general tablespace
CREATE TABLE t1 (col1 INT, col2 INT) ENGINE = InnoDB TABLESPACE innodb_system PARTITION BY KEY(col1) PARTITIONS 3;

SHOW CREATE TABLE t1;

--source suite/innodb/include/show_i_s_tables.inc
--source suite/innodb/include/show_i_s_tablespaces.inc

ALTER TABLE t1 ENGINE = InnoDB TABLESPACE s1;

SHOW CREATE TABLE t1;

--source suite/innodb/include/show_i_s_tables.inc
--source suite/innodb/include/show_i_s_tablespaces.inc

DROP TABLE t1;

# Change tablespace of partitioned table from general tablespace
# to innodb_file_per_table
CREATE TABLE t1 (col1 INT, col2 INT) ENGINE = InnoDB TABLESPACE s1 PARTITION BY KEY(col1) PARTITIONS 3;

SHOW CREATE TABLE t1;

--source suite/innodb/include/show_i_s_tables.inc
--source suite/innodb/include/show_i_s_tablespaces.inc

ALTER TABLE t1 ENGINE = InnoDB TABLESPACE innodb_file_per_table;

SHOW CREATE TABLE t1;

--source suite/innodb/include/show_i_s_tables.inc
--source suite/innodb/include/show_i_s_tablespaces.inc

DROP TABLE t1;

# Change tablespace of partitioned table from general tablespace
# to innodb_system
CREATE TABLE t1 (col1 INT, col2 INT) ENGINE = InnoDB TABLESPACE s1 PARTITION BY KEY(col1) PARTITIONS 3;

SHOW CREATE TABLE t1;

--source suite/innodb/include/show_i_s_tables.inc
--source suite/innodb/include/show_i_s_tablespaces.inc

ALTER TABLE t1 ENGINE = InnoDB TABLESPACE innodb_system;

SHOW CREATE TABLE t1;

--source suite/innodb/include/show_i_s_tables.inc
--source suite/innodb/include/show_i_s_tablespaces.inc

DROP TABLE t1;

DROP TABLESPACE s1;
