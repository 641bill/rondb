# Creating geometry objects and parameters.
USE test;
CREATE TABLE gis_geometries (fid INTEGER NOT NULL PRIMARY KEY, g GEOMETRY);
# INSERT into table
INSERT INTO gis_geometries VALUES
(119,ST_GEOMFROMTEXT('POINT(0 179)', 4326)),
(120,ST_GEOMFROMTEXT('POINT(0 -179)', 4326));
# Checking the integrity of above create/insert statements
# 2 rows.
SELECT count(ST_ASTEXT(g) != 'NULL') FROM gis_geometries;
count(ST_ASTEXT(g) != 'NULL')
2
SET @pt_lat_minus_91 = x'E6100000010100000000000000000000000000000000C056C0';
SET @pt_lat_plus_91 = x'E6100000010100000000000000000000000000000000C05640';
SET @pt_long_minus_181 = x'E610000001010000000000000000A066C00000000000000000';
SET @pt_long_plus_181 = x'E610000001010000000000000000A066400000000000000000';
SET @p_square = ST_BUFFER_STRATEGY('point_square');
SET @p_circle = ST_BUFFER_STRATEGY('point_circle', 42);
SET @e_flat = ST_BUFFER_STRATEGY('end_flat');
SET @e_round = ST_BUFFER_STRATEGY('end_round', 42);
SET @j_miter = ST_BUFFER_STRATEGY('join_miter', 3.3);
SET @j_round = ST_BUFFER_STRATEGY('join_round', 42);
SET @geo_pt = ST_GEOMFROMTEXT('POINT(0 0)', 4326);
SET @cart_pt = ST_GEOMFROMTEXT('POINT(0 0)');
SET @cart_ls = ST_GEOMFROMTEXT('LINESTRING(0 0, 1 1, 2 0)');
SET @cart_py = ST_GEOMFROMTEXT('POLYGON((0 0, 0 1, 1 1, 1 0, 0 0))');
SET @cart_mpt = ST_GEOMFROMTEXT('MULTIPOINT((0 0), (2 2))');
SET @cart_mls = ST_GEOMFROMTEXT('MULTILINESTRING((0 0, 1 1, 2 0), (3 0, 4 1, 5 0))');
SET @cart_mpy = ST_GEOMFROMTEXT('MULTIPOLYGON(((0 0, 0 1, 1 1, 1 0, 0 0)), ((3 0, 3 1, 4 1, 4 0, 3 0)))');
SET @cart_gc = ST_GEOMFROMTEXT('GEOMETRYCOLLECTION(POINT(0 0), LINESTRING(0 0, 1 1, 2 0), POLYGON((0 0, 0 1, 1 1, 1 0, 0 0)))');
#####################################################################################
# ST_BUFFER(geometry, distance, [strategy1, strategy2, strategy3])
#####################################################################################
SELECT ST_ASTEXT(ST_BUFFER(@cart_pt, 2, ST_BUFFER_STRATEGY('point_square')));
ST_ASTEXT(ST_BUFFER(@cart_pt, 2, ST_BUFFER_STRATEGY('point_square')))
POLYGON((-2 -2,2 -2,2 2,-2 2,-2 -2))
SELECT ST_ASTEXT(ST_BUFFER(ST_GEOMFROMTEXT('POINT(0 0)'), 2, @p_square));
ST_ASTEXT(ST_BUFFER(ST_GEOMFROMTEXT('POINT(0 0)'), 2, @p_square))
POLYGON((-2 -2,2 -2,2 2,-2 2,-2 -2))
SELECT ST_ASTEXT(ST_BUFFER(g, 200000)) FROM gis_geometries WHERE fid=119;
ST_ASTEXT(ST_BUFFER(g, 200000))
POLYGON((1.808732012131739 179.00179722331927,1.7743197900479146 178.65114627062792,1.6717032635523004 178.31392607028621,1.5048357061864404 178.00311217180106,1.2801423568706964 177.7306515619975,1.0062692483347249 177.50700268532773,0.6937471726819848 177.3407376070744,0.3545849688985597 177.238220226374,0.0018084402572923833 177.20337032948348,-0.3510375202739719 177.2375196521585,-0.6904053735422317 177.3393632339019,-1.003261471998694 177.5050070843585,-1.2775842159859905 177.72811116257705,-1.5028256012439338 178.00012441210453,-1.6703185702297556 178.31060571624758,-1.773613842393487 178.64762102317152,-1.8087320121320265 178.99820277668073,-1.774319790047916 179.34885372937208,-1.671703263552299 179.6860739297138,-1.5048357061864388 179.99688782819894,-1.2801423568706942 -179.73065156199783,-1.0062692483347215 -179.50700268532808,-0.6937471726819808 -179.34073760707474,-0.35458496889855534 -179.23822022637435,-0.0018084402572879658 -179.2033703294838,0.35103752027397617 -179.23751965215885,0.6904053735422359 -179.33936323390225,1.0032614719986979 -179.50500708435888,1.2775842159859927 -179.72811116257742,1.502825601243936 179.9998755878955,1.6703185702297558 179.68939428375242,1.7736138423934877 179.3523789768285,1.808732012131739 179.00179722331927))
SELECT ST_ASTEXT(ST_BUFFER(g, 200000)) FROM gis_geometries WHERE fid=120;
ST_ASTEXT(ST_BUFFER(g, 200000))
POLYGON((1.808732012131739 -178.99820277668073,1.7743197900479146 -179.34885372937208,1.6717032635523004 -179.6860739297138,1.5048357061864404 -179.99688782819894,1.2801423568706964 179.73065156199783,1.0062692483347249 179.50700268532808,0.6937471726819848 179.34073760707474,0.3545849688985597 179.23822022637435,0.0018084402572923833 179.2033703294838,-0.3510375202739719 179.23751965215885,-0.6904053735422317 179.33936323390225,-1.003261471998694 179.50500708435885,-1.2775842159859905 179.7281111625774,-1.5028256012439338 -179.9998755878955,-1.6703185702297556 -179.68939428375242,-1.773613842393487 -179.3523789768285,-1.8087320121320265 -179.00179722331927,-1.774319790047916 -178.65114627062792,-1.671703263552299 -178.31392607028621,-1.5048357061864388 -178.00311217180106,-1.2801423568706942 -177.7306515619975,-1.0062692483347215 -177.50700268532773,-0.6937471726819808 -177.3407376070744,-0.35458496889855534 -177.238220226374,-0.0018084402572879658 -177.20337032948348,0.35103752027397617 -177.2375196521585,0.6904053735422359 -177.3393632339019,1.0032614719986979 -177.50500708435854,1.2775842159859927 -177.72811116257708,1.502825601243936 -178.00012441210453,1.6703185702297558 -178.31060571624758,1.7736138423934877 -178.64762102317152,1.808732012131739 -178.99820277668073))
DROP TABLE gis_geometries;
#####################################################################################
# Invalid function calls
#####################################################################################
SELECT ST_ASTEXT(ST_BUFFER(ST_GEOMFROMTEXT('GEOMETRYCOLLECTION()'), 20));
ST_ASTEXT(ST_BUFFER(ST_GEOMFROMTEXT('GEOMETRYCOLLECTION()'), 20))
GEOMETRYCOLLECTION EMPTY
SELECT ST_ASTEXT(ST_BUFFER(NULL, 1));
ST_ASTEXT(ST_BUFFER(NULL, 1))
NULL
DO ST_ASTEXT(ST_BUFFER(@cart_pt, 1, @e_flat));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_pt, 1, @j_round));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_pt, -1));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_ls, 2, @p_square));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_ls, -2));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_py, 3, @p_square));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_py, 3, @e_flat));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_mpt, 4, @e_flat));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_mpt, 4, @j_round));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_mpt, -4));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_mls, 5, @p_square));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_mls, -5));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_mpy, 6, @p_square));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_mpy, 6, @e_flat));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_gc, -7));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@geo_pt, 2000, @p_square));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@geo_pt, 2000, @e_flat));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@geo_pt, 2000, @j_round));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@geo_pt, -2000));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_pt, 1, @p_square, @p_circle));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_pt, 1, @p_circle, @p_square));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_ls, 2, @e_flat, @e_round));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_ls, 2, @e_round, @e_flat));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_py, 2, @j_miter, @j_round));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_py, 2, @j_round, @j_miter));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(@cart_pt, 2, 2));
ERROR HY000: Incorrect arguments to st_buffer
DO ST_ASTEXT(ST_BUFFER(ST_GEOMFROMTEXT('POINT(12,34 0)'), 1));
ERROR 22023: Invalid GIS data provided to function st_geomfromtext.
DO ST_ASTEXT(ST_BUFFER(ST_GEOMFROMTEXT('LINESTRING(0 0, 2 0, 2 2, 2 0, 1 1)', 4326), 100));
ERROR 22S00: st_buffer(LINESTRING) has not been implemented for geographic spatial reference systems.
DO ST_BUFFER(@pt_lat_minus_91, 20000);
ERROR 22S03: A parameter of function st_buffer contains a geometry with latitude -91.000000, which is out of range. It must be within [-90.000000, 90.000000].
DO ST_BUFFER(@pt_lat_plus_91, 20000);
ERROR 22S03: A parameter of function st_buffer contains a geometry with latitude 91.000000, which is out of range. It must be within [-90.000000, 90.000000].
DO ST_BUFFER(@pt_long_minus_181, 20000);
ERROR 22S02: A parameter of function st_buffer contains a geometry with longitude -181.000000, which is out of range. It must be within (-180.000000, 180.000000].
DO ST_BUFFER(@pt_long_plus_181, 20000);
ERROR 22S02: A parameter of function st_buffer contains a geometry with longitude 181.000000, which is out of range. It must be within (-180.000000, 180.000000].
# Assume SRID 10 is not defined.
DO ST_BUFFER(x'0A000000010100000000000000000000000000000000000000', 10);
ERROR SR001: There's no spatial reference system with SRID 10.
