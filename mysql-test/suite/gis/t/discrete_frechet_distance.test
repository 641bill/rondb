# Top-level coverage tests for ST_DISCRETE_FRECHET_DISTANCE function.

# NULL handling
SELECT ST_DISCRETE_FRECHET_DISTANCE(NULL,NULL);
SELECT ST_DISCRETE_FRECHET_DISTANCE(NULL,'');

# Test error wrong number of arguments.
--error ER_WRONG_PARAMCOUNT_TO_NATIVE_FCT
DO ST_DISCRETE_FRECHET_DISTANCE('LINESTRING(0 0, 0 1)');

# Test error forwarding from geometry parsing.
--error ER_GIS_INVALID_DATA
DO ST_DISCRETE_FRECHET_DISTANCE('','');

--error ER_SRS_NOT_FOUND
DO ST_DISCRETE_FRECHET_DISTANCE
(ST_GEOMFROMTEXT('LINESTRING(0 0,1 1,2 1,1 2,2 2)', 4294967295),
 ST_GEOMFROMTEXT('LINESTRING(0 1,1 0,1 1,1 2,1 3)', 0));

--error ER_GIS_DIFFERENT_SRIDS
DO ST_DISCRETE_FRECHET_DISTANCE
(ST_GEOMFROMTEXT('LINESTRING(0 0,1 1,2 1,1 2,2 2)', 4326),
 ST_GEOMFROMTEXT('LINESTRING(0 1,1 0,1 1,1 2,1 3)', 0));

# Test error on unsupported types.
# there are no unsupported types

# Test error on not implemented types.
--error ER_NOT_IMPLEMENTED_FOR_CARTESIAN_SRS
DO ST_DISCRETE_FRECHET_DISTANCE(ST_GEOMFROMTEXT('POINT(0 0)'), ST_GEOMFROMTEXT('POINT(0 1)'));
--error ER_NOT_IMPLEMENTED_FOR_CARTESIAN_SRS
DO ST_DISCRETE_FRECHET_DISTANCE(ST_GEOMFROMTEXT('LINESTRING(0 0, 0 1)'), ST_GEOMFROMTEXT('MULTIPOINT(0 1)'));
--error ER_NOT_IMPLEMENTED_FOR_CARTESIAN_SRS
DO ST_DISCRETE_FRECHET_DISTANCE(ST_GEOMFROMTEXT('LINESTRING(0 0, 0 1)'), ST_GEOMFROMTEXT('MULTILINESTRING((0 0, 1 0))'));
--error ER_NOT_IMPLEMENTED_FOR_CARTESIAN_SRS
DO ST_DISCRETE_FRECHET_DISTANCE(ST_GEOMFROMTEXT('LINESTRING(0 0, 0 1)'), ST_GEOMFROMTEXT('POLYGON((0 0, 1 0, 1 1, 0 0))'));
--error ER_NOT_IMPLEMENTED_FOR_CARTESIAN_SRS
DO ST_DISCRETE_FRECHET_DISTANCE(ST_GEOMFROMTEXT('LINESTRING(0 0, 0 1)'), ST_GEOMFROMTEXT('MULTIPOLYGON(((0 0, 1 0, 1 1, 0 0)))'));
--error ER_NOT_IMPLEMENTED_FOR_GEOGRAPHIC_SRS
DO ST_DISCRETE_FRECHET_DISTANCE(ST_GEOMFROMTEXT('MULTIPOLYGON(((0 0, 1 0, 1 1, 0 0)))', 4326), ST_GEOMFROMTEXT('LINESTRING(0 0, 0 1)', 4326));
--error ER_NOT_IMPLEMENTED_FOR_CARTESIAN_SRS
DO ST_DISCRETE_FRECHET_DISTANCE(ST_GEOMFROMTEXT('LINESTRING(0 0, 0 1)'), ST_GEOMFROMTEXT('GEOMETRYCOLLECTION(LINESTRING(0 0, 0 1))'));
--error ER_NOT_IMPLEMENTED_FOR_CARTESIAN_SRS
DO ST_DISCRETE_FRECHET_DISTANCE(ST_GEOMFROMTEXT('GEOMETRYCOLLECTION(LINESTRING(0 0, 0 1))'), ST_GEOMFROMTEXT('LINESTRING(0 0, 0 1)'));
--error ER_NOT_IMPLEMENTED_FOR_GEOGRAPHIC_SRS
DO ST_DISCRETE_FRECHET_DISTANCE(ST_GEOMFROMTEXT('GEOMETRYCOLLECTION(LINESTRING(0 0, 0 1))', 4326), ST_GEOMFROMTEXT('GEOMETRYCOLLECTION(LINESTRING(0 0, 0 1))', 4326));


# Test error due to numeric overflow.
--error ER_DATA_OUT_OF_RANGE
DO ST_DISCRETE_FRECHET_DISTANCE(ST_GEOMFROMTEXT('LINESTRING(0 0, 0 1e308, 1e308 1e308)'), ST_GEOMFROMTEXT('LINESTRING(0 0, 0 1)'));


# Excercise code on supported types.
# Cartesian
SELECT
  ROUND(
    ST_DISCRETE_FRECHET_DISTANCE
       (ST_GEOMFROMTEXT('LINESTRING(0 0,1 1,2 1,1 2,2 2)', 0),
        ST_GEOMFROMTEXT('LINESTRING(0 1,1 0,1 1,1 2,1 3)', 0)),
    2
  ) AS dfd;

# test if ellipsoid of SRID is actually used in computation
CREATE SPATIAL REFERENCE SYSTEM 1004326
  NAME 'WGS 84 (long-lat) different flattening'
  DEFINITION 'GEOGCS["WGS 84",DATUM["World Geodetic System 1984",SPHEROID["WGS 84",6378137,290,AUTHORITY["EPSG","7030"]],AUTHORITY["EPSG","6326"]],PRIMEM["Greenwich",0,AUTHORITY["EPSG","8901"]],UNIT["degree",0.017453292519943278,AUTHORITY["EPSG","9122"]],AXIS["Lon",EAST],AXIS["Lat",NORTH]]'
  DESCRIPTION 'WGS 84 with coordinate axes swapped to be longitude-latitude instead of latitude-longitude';
  SELECT
    ROUND(
      ST_DISCRETE_FRECHET_DISTANCE
         (ST_GEOMFROMTEXT('LINESTRING(0 0,1 1,2 1,1 2,2 2)', 1004326),
          ST_GEOMFROMTEXT('LINESTRING(0 1,1 0,1 1,1 2,1 3)', 1004326)),
      2
    ) AS dfd;



# End of top-level coverage test.
