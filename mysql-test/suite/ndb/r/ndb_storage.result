CREATE LOGFILE GROUP lg1
ADD UNDOFILE 'lg1_undofile.dat'
  INITIAL_SIZE 1M
UNDO_BUFFER_SIZE = 1M
ENGINE=ndb;
CREATE TABLESPACE ts1
ADD DATAFILE 'ts1_datafile.dat'
  USE LOGFILE GROUP lg1
INITIAL_SIZE 10M
ENGINE ndb;
CREATE TABLE t5 (a int PRIMARY KEY, t5b int, t5c int)
ENGINE ndb;
INSERT INTO t5 VALUES (1, 1, 1);
ALTER TABLE t5 ALGORITHM=inplace, STORAGE disk TABLESPACE ts1;
ERROR 0A000: ALGORITHM=INPLACE is not supported. Reason: Column storage media is changed due to change in table storage media. Try ALGORITHM=COPY.
ALTER TABLE t5 STORAGE DISK TABLESPACE ts1;
ALTER TABLESPACE ts1
DROP DATAFILE 'ts1_datafile.dat'
  ENGINE=ndb;
ERROR HY000: Failed to alter:  DROP DATAFILE
ALTER TABLE t5 STORAGE memory;
ALTER TABLESPACE ts1
DROP DATAFILE 'ts1_datafile.dat'
  ENGINE=ndb;
SELECT * FROM t5;
a	t5b	t5c
1	1	1
DROP TABLE t5;
DROP TABLESPACE ts1 ENGINE ndb;
CREATE TABLESPACE ts1
ADD DATAFILE 'ts1_datafile.dat'
  USE LOGFILE GROUP lg1
INITIAL_SIZE 10M
ENGINE ndb;
CREATE TABLE t5 (a int PRIMARY KEY, t5b int, t5c int)
ENGINE ndb;
INSERT INTO t5 VALUES (1, 1, 1);
ALTER TABLE t5 CHANGE t5b t5b int STORAGE disk, TABLESPACE ts1;
ALTER TABLESPACE ts1
DROP DATAFILE 'ts1_datafile.dat'
  ENGINE ndb;
ERROR HY000: Failed to alter:  DROP DATAFILE
ALTER TABLE t5 CHANGE t5b t5b int STORAGE memory;
ALTER TABLESPACE ts1
DROP DATAFILE 'ts1_datafile.dat'
  ENGINE ndb;
SELECT * FROM t5;
a	t5b	t5c
1	1	1
DROP TABLE t5;
DROP TABLESPACE ts1 ENGINE ndb;
CREATE TABLESPACE ts1
ADD DATAFILE 'ts1_datafile.dat'
  USE LOGFILE GROUP lg1
INITIAL_SIZE 10M
ENGINE ndb;
CREATE TABLE t5 (a int PRIMARY KEY, t5b tinyblob,
t5c tinytext, t5d int unique key STORAGE disk)
TABLESPACE ts1 ENGINE ndb;
ERROR HY000: Cannot create index on DISK column 't5d'. Alter it in a way to use STORAGE MEMORY.
SHOW WARNINGS;
Level	Code	Message
Error	1478	Cannot create index on DISK column 't5d'. Alter it in a way to use STORAGE MEMORY.
Error	1112	Table 't5' uses an extension that doesn't exist in this MySQL version
CREATE TABLE t5 (a int PRIMARY KEY, t5b tinyblob,
t5c tinytext, t5d int STORAGE disk)
TABLESPACE ts1 ENGINE ndb;
CREATE INDEX 5d_i ON t5(t5d);
ERROR HY000: Cannot create index on DISK column 't5d'. Alter it in a way to use STORAGE MEMORY.
ALTER TABLE t5 ADD INDEX 5d_i (t5d);
ERROR HY000: Cannot create index on DISK column 't5d'. Alter it in a way to use STORAGE MEMORY.
DROP TABLE t5;
CREATE TABLE t5 (a int PRIMARY KEY, t5b tinyblob,
t5c tinytext, t5d int)
STORAGE disk TABLESPACE ts1 ENGINE ndb;
CREATE INDEX 5d_i ON t5(t5d);
-- t5 --
Version: 16777219
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 4
Number of primary keys: 1
Length of frm data: 334
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 0
ForceVarPart: 1
PartitionCount: 8
FragmentCount: 8
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
HashMap: DEFAULT-HASHMAP-3840-8
-- Attributes --
a Int PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
t5b Blob(256,0,0) NULL AT=MEDIUM_VAR ST=MEMORY BV=2 BT=<none>
t5c Text(256,0,0;latin1_swedish_ci) NULL AT=MEDIUM_VAR ST=MEMORY BV=2 BT=<none>
t5d Int NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(a) - UniqueHashIndex
PRIMARY(a) - OrderedIndex
5d_i(t5d) - OrderedIndex

NDBT_ProgramExit: 0 - OK

DROP INDEX 5d_i on t5;
-- t5 --
Version: 33554435
Fragment type: HashMapPartition
K Value: 6
Min load factor: 78
Max load factor: 80
Temporary table: no
Number of attributes: 4
Number of primary keys: 1
Length of frm data: 318
Max Rows: 0
Row Checksum: 1
Row GCI: 1
SingleUserMode: 0
ForceVarPart: 1
PartitionCount: 8
FragmentCount: 8
PartitionBalance: FOR_RP_BY_LDM
ExtraRowGciBits: 0
ExtraRowAuthorBits: 0
TableStatus: Retrieved
Table options:
HashMap: DEFAULT-HASHMAP-3840-8
-- Attributes --
a Int PRIMARY KEY DISTRIBUTION KEY AT=FIXED ST=MEMORY
t5b Blob(256,0,0) NULL AT=MEDIUM_VAR ST=MEMORY BV=2 BT=<none>
t5c Text(256,0,0;latin1_swedish_ci) NULL AT=MEDIUM_VAR ST=MEMORY BV=2 BT=<none>
t5d Int NULL AT=FIXED ST=MEMORY
-- Indexes -- 
PRIMARY KEY(a) - UniqueHashIndex
PRIMARY(a) - OrderedIndex

NDBT_ProgramExit: 0 - OK

ALTER TABLE t5 ADD INDEX 5d_i(t5d);
DROP TABLE t5;
ALTER TABLESPACE ts1
DROP DATAFILE 'ts1_datafile.dat'
  ENGINE=ndb;
DROP TABLESPACE ts1 ENGINE=ndb;
DROP LOGFILE GROUP lg1 ENGINE=ndb;
