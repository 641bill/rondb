drop table if exists t2, t1;
# bug#14095785
create table t1 (
a int not null,
b int not null,
primary key using hash (a),
unique key using hash (b)
) engine ndb;
create table t2 (
a int not null,
b int not null,
primary key using hash (a),
key (b)
) engine ndb;
alter table t2
add constraint foreign key (b) references t1 (b);
alter table t2
drop foreign key;
ERROR 42000: Drop foreign key must specify key name
drop table t2, t1;
# bug#14095838
create table t1 (
a int not null,
primary key using hash (a)
) engine ndb;
create table t2 (
a int not null,
b int not null,
primary key using hash (a),
key (b)
) engine ndb;
alter table t2
add constraint fk1 foreign key (b) references t1 (a)
on delete cascade on update cascade;
ERROR HY000: Cannot add foreign key constraint
show warnings;
Level	Code	Message
Warning	1296	Got error 21000 'Create foreign key failed - parent key is primary key and on-update-cascade is not allowed' from NDB
Error	150	Cannot add foreign key constraint
alter table t2
add constraint fk1 foreign key (b) references t1 (a)
on delete cascade on update restrict;
drop table t2, t1;
CREATE TABLE customer (id INT NOT NULL, PRIMARY KEY (id)) ENGINE=NDB;
CREATE TABLE product (category INT NOT NULL, id INT NOT NULL,
price DECIMAL, PRIMARY KEY(category, id)) ENGINE=NDB;
CREATE TABLE product_order (no INT NOT NULL AUTO_INCREMENT, product_category INT NOT NULL, product_id INT NOT NULL, customer_id INT NOT NULL, PRIMARY KEY(no), INDEX (product_category, product_id), FOREIGN KEY (product_category, product_id) REFERENCES product(category, id) ON UPDATE CASCADE ON DELETE RESTRICT, INDEX (customer_id), FOREIGN KEY (customer_id) REFERENCES customer(id)) ENGINE=ndb;
ERROR HY000: Can't create table 'test.product_order' (errno: 150)
show warnings;
Level	Code	Message
Warning	1296	Got error 21000 'Create foreign key failed - parent key is primary key and on-update-cascade is not allowed' from NDB
Error	1005	Can't create table 'test.product_order' (errno: 150)
CREATE TABLE product_order (no INT NOT NULL AUTO_INCREMENT, product_category INT NOT NULL, product_id INT NOT NULL, customer_id INT NOT NULL, PRIMARY KEY(no), INDEX (product_category, product_id), FOREIGN KEY (product_category, product_id) REFERENCES product(category, id) ON UPDATE CASCADE ON DELETE RESTRICT, INDEX (customer_id), FOREIGN KEY (customer_id) REFERENCES customer(id)) ENGINE=ndb;
ERROR HY000: Can't create table 'test.product_order' (errno: 150)
show warnings;
Level	Code	Message
Warning	1296	Got error 21000 'Create foreign key failed - parent key is primary key and on-update-cascade is not allowed' from NDB
Error	1005	Can't create table 'test.product_order' (errno: 150)
DROP TABLE customer, product;
