--source include/have_ndb.inc
--source suite/ndb/include/ndb_find_import_tool.inc
#-- source suite/ndb/include/backup_restore_setup.inc

--echo # manual ndb_import tests

--let IS_WINDOWS= `select convert(@@version_compile_os using latin1) in ('Win32', 'Win64', 'Windows')`

# LOAD DATA line terminators
--let $lt_unix='\n'
--let $lt_windows='\r\n'
if (!$IS_WINDOWS) {
  --let $lt_default=$lt_unix
}
if ($IS_WINDOWS) {
  --let $lt_default=$lt_windows
}

SET @session_ai_prefetch_sz = @@session.ndb_autoincrement_prefetch_sz;

set session ndb_autoincrement_prefetch_sz=16;

--write_file $MYSQLTEST_VARDIR/tmp/t10.csv
a|b|c
\N|1288|10000
\N|2288|20000
EOF

create table t10 (
  a tinyint not null auto_increment primary key,
  b int,
  c bigint
) engine ndb;

exec $NDB_IMPORT --state-dir=$MYSQLTEST_VARDIR/tmp
      --keep-state --log-level=1
      --fields-terminated-by='|' --ignore-lines=1
      test
      $MYSQLTEST_VARDIR/tmp/t10.csv >> $NDB_TOOLS_OUTPUT 2>&1;

select * from t10 order by a;
drop table t10;

create table t10 (
  a tinyint unsigned not null auto_increment primary key,
  b int,
  c bigint
) engine ndb;

exec $NDB_IMPORT --state-dir=$MYSQLTEST_VARDIR/tmp
      --keep-state --log-level=1
      --fields-terminated-by='|' --ignore-lines=1
      test
      $MYSQLTEST_VARDIR/tmp/t10.csv >> $NDB_TOOLS_OUTPUT 2>&1;

select * from t10 order by a;
drop table t10;

create table t10 (
  a smallint not null auto_increment primary key,
  b int,
  c bigint
) engine ndb;

exec $NDB_IMPORT --state-dir=$MYSQLTEST_VARDIR/tmp
      --keep-state --log-level=1
      --fields-terminated-by='|' --ignore-lines=1
      test
      $MYSQLTEST_VARDIR/tmp/t10.csv >> $NDB_TOOLS_OUTPUT 2>&1;

select * from t10 order by a;
drop table t10;

create table t10 (
  a smallint unsigned not null auto_increment primary key,
  b int,
  c bigint
) engine ndb;

exec $NDB_IMPORT --state-dir=$MYSQLTEST_VARDIR/tmp
      --keep-state --log-level=1
      --fields-terminated-by='|' --ignore-lines=1
      test
      $MYSQLTEST_VARDIR/tmp/t10.csv >> $NDB_TOOLS_OUTPUT 2>&1;

select * from t10 order by a;
drop table t10;

set session ndb_autoincrement_prefetch_sz=@session_ai_prefetch_sz;

create table t10 (
  a mediumint not null auto_increment primary key,
  b int,
  c bigint
) engine ndb;

exec $NDB_IMPORT --state-dir=$MYSQLTEST_VARDIR/tmp
      --keep-state --log-level=1
      --fields-terminated-by='|' --ignore-lines=1
      test
      $MYSQLTEST_VARDIR/tmp/t10.csv >> $NDB_TOOLS_OUTPUT 2>&1;

select * from t10 order by a;
drop table t10;

create table t10 (
  a mediumint unsigned not null auto_increment primary key,
  b int,
  c bigint
) engine ndb;

exec $NDB_IMPORT --state-dir=$MYSQLTEST_VARDIR/tmp
      --keep-state --log-level=1
      --fields-terminated-by='|' --ignore-lines=1
      test
      $MYSQLTEST_VARDIR/tmp/t10.csv >> $NDB_TOOLS_OUTPUT 2>&1;

select * from t10 order by a;
drop table t10;

create table t10 (
  a int not null auto_increment primary key,
  b int,
  c bigint
) engine ndb;

exec $NDB_IMPORT --state-dir=$MYSQLTEST_VARDIR/tmp
      --keep-state --log-level=1
      --fields-terminated-by='|' --ignore-lines=1
      test
      $MYSQLTEST_VARDIR/tmp/t10.csv >> $NDB_TOOLS_OUTPUT 2>&1;

select * from t10 order by a;
drop table t10;

create table t10 (
  a int unsigned not null auto_increment primary key,
  b int,
  c bigint
) engine ndb;

exec $NDB_IMPORT --state-dir=$MYSQLTEST_VARDIR/tmp
      --keep-state --log-level=1
      --fields-terminated-by='|' --ignore-lines=1
      test
      $MYSQLTEST_VARDIR/tmp/t10.csv >> $NDB_TOOLS_OUTPUT 2>&1;

select * from t10 order by a;
drop table t10;

create table t10 (
  a bigint not null auto_increment primary key,
  b int,
  c bigint
) engine ndb;

exec $NDB_IMPORT --state-dir=$MYSQLTEST_VARDIR/tmp
      --keep-state --log-level=1
      --fields-terminated-by='|' --ignore-lines=1
      test
      $MYSQLTEST_VARDIR/tmp/t10.csv >> $NDB_TOOLS_OUTPUT 2>&1;

select * from t10 order by a;
drop table t10;

create table t10 (
  a bigint unsigned not null auto_increment primary key,
  b int,
  c bigint
) engine ndb;

exec $NDB_IMPORT --state-dir=$MYSQLTEST_VARDIR/tmp
      --keep-state --log-level=1
      --fields-terminated-by='|' --ignore-lines=1
      test
      $MYSQLTEST_VARDIR/tmp/t10.csv >> $NDB_TOOLS_OUTPUT 2>&1;

select * from t10 order by a;
drop table t10;

--remove_files_wildcard $MYSQLTEST_VARDIR/tmp t*.csv
--remove_files_wildcard $MYSQLTEST_VARDIR/tmp t*.map
--remove_files_wildcard $MYSQLTEST_VARDIR/tmp t*.rej
--remove_files_wildcard $MYSQLTEST_VARDIR/tmp t*.res
--remove_files_wildcard $MYSQLTEST_VARDIR/tmp t*.sto
--remove_files_wildcard $MYSQLTEST_VARDIR/tmp t*.stt
--remove_file $NDB_TOOLS_OUTPUT
