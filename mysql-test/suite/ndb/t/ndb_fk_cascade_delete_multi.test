-- source include/have_ndb.inc
-- source have_ndb_fk.inc

create table emp (
  id int primary key auto_increment,
  name varchar(256) not null,
  manager int,
  index(manager)) engine = ndb;

alter table emp add constraint fkname foreign key (manager) references emp(id) on update restrict on delete cascade;

insert into emp values
(1, 'larry', null)
,(2, 'eddie', 1)
,(3, 'tomas', 2)
,(4, 'ricky', 2)
,(5, 'edwin', 2)
,(6, 'bockie', 3)
,(7, 'jonas', 6)
,(8, 'magnus', 6)
,(9, 'frasse', 6)
,(10, 'samuel', 7)
,(11, 'jonatan', 7)
,(12, 'wille', 8);

select * from emp order by 1;
begin;
# lets see what happens if we rif cluster
delete from emp where id=6;
select * from emp order by 1;
rollback;
select * from emp order by 1;

alter table emp drop foreign key fkname;

drop table emp;
