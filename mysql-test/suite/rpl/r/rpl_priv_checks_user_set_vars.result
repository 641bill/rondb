include/master-slave.inc
Warnings:
Note	####	Sending passwords in plain text without SSL/TLS is extremely insecure.
Note	####	Storing MySQL user name or password information in the master info repository is not secure and is therefore not recommended. Please consider using the USER and PASSWORD connection options for START SLAVE; see the 'START SLAVE Syntax' in the MySQL Manual for more information.
[connection master]
[connection slave]
GRANT REPLICATION_APPLIER, CREATE, DROP ON *.* TO 'u1'@'localhost';
SHOW GRANTS FOR 'u1'@'localhost';
Grants for u1@localhost
GRANT CREATE, DROP ON *.* TO `u1`@`localhost`
GRANT REPLICATION_APPLIER ON *.* TO `u1`@`localhost`
#
# TC1. Verify that setting `default_table_encryption` only succeeds on
#      the slave when having `SUPER` or `SYSTEM_VARIABLES_ADMIN` and
#      `TABLE_ENCRYPTION_ADMIN`
# --------------------------------------------------------------------
#
[connection master]
SET default_table_encryption = 1;
CREATE DATABASE new_db;
[connection slave]
CALL mtr.add_suppression(".*you need .at least one of. the SUPER or SYSTEM_VARIABLES_ADMIN and TABLE_ENCRYPTION_ADMIN.*");
CALL mtr.add_suppression(".*The slave coordinator and worker threads are stopped.*");
REVOKE SUPER, SYSTEM_VARIABLES_ADMIN, TABLE_ENCRYPTION_ADMIN ON *.* FROM 'u1'@'localhost';
Warnings:
Warning	1287	The SUPER privilege identifier is deprecated
START SLAVE;
include/wait_for_slave_sql_error.inc [errno=1227]
STOP SLAVE;
GRANT SYSTEM_VARIABLES_ADMIN, TABLE_ENCRYPTION_ADMIN ON *.* TO 'u1'@'localhost';
SHOW GRANTS FOR 'u1'@'localhost';
Grants for u1@localhost
GRANT CREATE, DROP ON *.* TO `u1`@`localhost`
GRANT REPLICATION_APPLIER,SYSTEM_VARIABLES_ADMIN,TABLE_ENCRYPTION_ADMIN ON *.* TO `u1`@`localhost`
START SLAVE;
[connection master]
include/sync_slave_sql_with_master.inc
include/assert.inc [Database new_db exists on slave]
[connection master]
DROP DATABASE new_db;
SET default_table_encryption = OPT_DEFAULT_TABLE_ENCRYPTION;
include/rpl_end.inc
