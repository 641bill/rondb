# Tests for PERFORMANCE_SCHEMA

--source include/not_embedded.inc
--source include/have_perfschema.inc

select OBJECT_INSTANCE_BEGIN from performance_schema.file_summary_by_instance limit 1
  into @oib;
select FILE_NAME from performance_schema.file_summary_by_instance limit 1
  into @fname;
select EVENT_NAME from performance_schema.file_summary_by_instance limit 1
  into @ename;

###########################################################################
# Test index on OBJECT_INSTANCE_BEGIN
###########################################################################

--disable_warnings
--echo ############ Explain for Query ####################################
--replace_column 10 #
explain select EVENT_NAME, COUNT_STAR
  from performance_schema.file_summary_by_instance
  where OBJECT_INSTANCE_BEGIN = "impossible";

--echo ############ Explain for Query ####################################
--replace_column 10 #
explain select EVENT_NAME, COUNT_STAR
  from performance_schema.file_summary_by_instance
  where OBJECT_INSTANCE_BEGIN = @oib;

--echo ############# Explain End #########################################
--enable_warnings

flush status;

--replace_column 1 #
select COUNT_STAR
  from performance_schema.file_summary_by_instance
  where OBJECT_INSTANCE_BEGIN = @oib;

show session status like "handler_read%";

--replace_column 1 #
select COUNT_STAR
  from performance_schema.file_summary_by_instance
  where OBJECT_INSTANCE_BEGIN = @oib;

show session status like "handler_read%";

###########################################################################
# Test index on EVENT_NAME
###########################################################################

--disable_warnings
--echo ############ Explain for Query ####################################
--replace_column 10 #
explain select COUNT_STAR
  from performance_schema.file_summary_by_instance
  where FILE_NAME = "impossible";

--echo ############ Explain for Query ####################################
--replace_column 10 #
explain select COUNT_STAR
  from performance_schema.file_summary_by_instance
  where FILE_NAME = @fname;

--echo ############# Explain End #########################################
--enable_warnings

flush status;

--replace_column 1 #
select COUNT_STAR
  from performance_schema.file_summary_by_instance
  where FILE_NAME = @fname;

show session status like "handler_read%";

--replace_column 1 #
select COUNT_STAR
  from performance_schema.file_summary_by_instance
  where FILE_NAME = @fname;

show session status like "handler_read%";

###########################################################################
# Test index on EVENT_NAME
###########################################################################

--disable_warnings
--echo ############ Explain for Query ####################################
--replace_column 10 #
explain select COUNT_STAR
  from performance_schema.file_summary_by_instance
  where EVENT_NAME = "impossible";

--echo ############ Explain for Query ####################################
--replace_column 10 #
explain select COUNT_STAR
  from performance_schema.file_summary_by_instance
  where EVENT_NAME = @ename;

--echo ############# Explain End #########################################
--enable_warnings

truncate table performance_schema.file_summary_by_instance;
flush status;

--replace_column 1 #
select  COUNT_STAR
  from performance_schema.file_summary_by_instance
  where EVENT_NAME = @ename;

show session status like "handler_read%";

--replace_column 1 #
select  COUNT_STAR
  from performance_schema.file_summary_by_instance
  where EVENT_NAME = @ename;

show session status like "handler_read%";
