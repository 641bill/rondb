#
# Bug#28339014 - KEYRING MIGRATION FAILS WHEN USER ONLY
#                HAVE READ ACCESS TO THE SOURCE KEYRING
#
# Restart mysql server with keyring_file plugin
# restart:--early-plugin-load=keyring_file.so --keyring-file-data=MYSQL_TMP_DIR/dir1/key1 --plugin-dir=KEYRING_PLUGIN_PATH
# Generate the key and make it read only
CREATE DATABASE bug28339014;
USE bug28339014;
CREATE TABLE t1(c1 INT) ENGINE = InnoDB ENCRYPTION="Y";
# Migrate the key
# Check the presence of destination keyring file
# Start the server with keyring_encrypted_file and check if the table t1 can be accessed.
# restart:--early-plugin-load=keyring_encrypted_file.so --keyring-encrypted-file-data=MYSQL_TMP_DIR/dir2/key2 --keyring-encrypted-file-password=ABC --plugin-dir=KEYRING_ENCRYPTED_PLUGIN_PATH
USE bug28339014;
SELECT * FROM t1;
c1
# Cleanup
DROP DATABASE bug28339014;
